name: Try runtime

run-name: "Workflow CI/CD Steps: execute try-runtime"

on:
  workflow_call:
  workflow_dispatch:

jobs:
  try-runtime:
    runs-on: warp-ubuntu-latest-x64-2x
    name: Try runtime
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download try-runtime wasm artifact
        uses: actions/download-artifact@v4
        with:
          name: "try-runtime"
          path: ${{ github.workspace }}

      - name: Execute try-runtime
        uses: ./.github/actions/cargo-cmd
        with:
          command: >-
            /bin/bash -c 'curl -sL https://github.com/paritytech/try-runtime-cli/releases/download/v0.8.0/try-runtime-x86_64-unknown-linux-musl -o /build/try-runtime
            && chmod +x /build/try-runtime
            && /build/try-runtime --runtime /build/zkv_runtime.compact.compressed.wasm on-runtime-upgrade --blocktime 6 --disable-mbm-checks --disable-spec-version-check live --uri wss://testnet-rpc.zkverify.io'
          use_cache: 'no'
